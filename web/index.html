<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <title>SKHEIJO</title>
        <!-- <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1"> -->
        <meta id="viewport" name="viewport" content="user-scalable=yes">
        <link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico"/>
        <link rel="icon" type="image/x-icon" href="img/favicon.ico"/>
        <link rel="stylesheet" type="text/css" href="css/style.css"/>
    </head>
    <body>
        <canvas id="confetti-ego"></canvas>
        <div id="main-container">
            <div id="usage-container">
                <div id="usage-warning">
                    <h1>WARNING!</h1>
                    <noscript>
                        This site requires JavaScript to function properly.
                        Please enable JavaScript in your browser settings.
                    </noscript>
                    <div data-warning="version" class="hidden">
                        <p>
                            This site relies on modern web browser features such as ECMAScript 2017, modern CSS, async/await, flexboxes, etc. to provide a seamless experience.
                            <br/>
                            You seem to access this site from a older browser (<span id="current-browser"></span>) which only partially supports these featrues.
                            As such, it is advisable to switch to newer browser versions.
                            Please find an enumeration of supported browser versions below:
                        </p>
                        <table id="supported-browsers">
                        </table>
                        <hr/>
                    </div>
                    <div data-warning="size" class="hidden">
                        <p>
                            This site relies on your device to possess a screen with a minimum horizontal <b>AND</b> minimum vertical resolution of <span id="min-width">500</span> pixels.
                            </br>
                            You are seeing this message because your device might not have a screen large enough to display this page correctly.
                            Please note that some features might suffer and/or the page be unusable.
                        </p>
                        <p>
                            It is advisable to view this page on a tablet or computer, as these generally possess lager screens than mobile phones.
                        </p>
                        <hr/>
                    </div>
                    <button id="usage-warning-dismiss" class="hidden">
                        I KNOW WHAT I AM DOING.
                        &nbsp;
                        DISMISS THE WARNING.
                    </button>
                </div>
            </div>
            <div id="notification-container">
                <table width="100%">
                    <tr width="100%">
                        <td id="notification-icon"><img src="img/notifications.svg" width="30px"/></td>
                        <td id="notification-content" width="100%"></td>
                        <td id="notification-close"><img src="img/close.svg" width="30px"/></td>
                    </tr>
                </table>
            </div>
            <div id="unblock-container" class="hidden">
                <div id="unblock-instructions">
                    <h1>Certificate unblock instructions</h1>
                    <div id="instruction-selector">
                        <div class="tab-selector">
                            <div class="tab active" data-tab="chrome">Chrome</div>
                            <div class="tab" data-tab="safari">Safari</div>
                            <div class="tab" data-tab="firefox">Firefox</div>
                        </div>
                        <div class="tab-container">
                            <div class="tab" data-tab="chrome">
                                <ol>
                                    <li>Navigate to <a class="unblock-url" target="_blank" href></a>.</li>
                                    <li>
                                        You will be confronted with the following error message:
                                        <br/>
                                        <img src="img/certificate-instructions/chrome-1.png"/>
                                    </li>
                                    <li>
                                        Click on <kbd>Advanced</kbd>, and then on <kbd>Proceed to <span class="unblock-url"></span> (unsafe)</kbd>:
                                        <br/>
                                        <img src="img/certificate-instructions/chrome-2.png"/>
                                    </li>
                                    <li>
                                        You should now see a message stating that <span class="unblock-url"></span> is not returning any data:
                                        <br/>
                                        <img src="img/certificate-instructions/chrome-3.png"/>
                                        <br/>
                                        This means that everything is working as intended.
                                        You may now close the opened tab and reload this page.
                                        Contact the server administrator should the error still persist after a page reload.
                                    </li>
                                </ol>
                            </div>
                            <div class="tab hidden" data-tab="firefox">
                                <ol>
                                    <li>Navigate to <a class="unblock-url" target="_blank" href></a>.</li>
                                    <li>
                                        You will be confronted with the following error message:
                                        <br/>
                                        <img src="img/certificate-instructions/firefox-1.png"/>
                                    </li>
                                    <li>
                                        Click on <kbd>Advanced ...</kbd>, and then on <kbd>Accept the Risk and Continue</kbd>:
                                        <br/>
                                        <img src="img/certificate-instructions/firefox-2.png"/>
                                    </li>
                                    <li>
                                        You should now see a message stating that an error occurred while connecting to <span class="unblock-url"></span>:
                                        <br/>
                                        <img src="img/certificate-instructions/firefox-3.png"/>
                                        <br/>
                                        This means that everything is working as intended.
                                        You may now close the opened tab and reload this page.
                                        Contact the server administrator should the error still persist after a page reload.
                                    </li>
                                </ol>
                            </div>
                            <div class="tab hidden" data-tab="safari">
                                <ol>
                                    <li>Navigate to <a class="unblock-url" target="_blank" href></a>.</li>
                                    <li>
                                        You will be confronted with the following error message:
                                        <br/>
                                        <img src="img/certificate-instructions/safari-1.png"/>
                                    </li>
                                    <li>
                                        Click on <kbd>Show Details</kbd>, and then on <kbd>visit this website</kbd>:
                                        <br/>
                                        <img src="img/certificate-instructions/safari-2.png"/>
                                    </li>
                                    <li>
                                        Confirm that you want to visit the site:
                                        <br/>
                                        <img src="img/certificate-instructions/safari-3.png"/>
                                    </li>
                                    <li>
                                        You should now see a message stating that the connection to <span class="unblock-url"></span> was lost:
                                        <br/>
                                        <img src="img/certificate-instructions/safari-4.png"/>
                                        <br/>
                                        This means that everything is working as intended.
                                        You may now close the opened tab and reload this page.
                                        Contact the server administrator should the error still persist after a page reload.
                                    </li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <p>
                        <button id="close-unblock-container">Close instructions</button>
                    </p>
                </div>
            </div>
            <div id="login-container" class="hidden">
                <div id="login-form">
                    <div id="login-decoration">
                        <div class="decoration" data-decoration="time">20 min</div>
                        <div class="decoration" data-decoration="count">2-10</div>
                        <div class="decoration" data-decoration="age">8+</div>
                    </div>
                    <div id="login-loading">
                        <span>Connecting ...</span>
                    </div>
                    <div id="login-failed">
                        <span>
                            <h1>
                                <img src="img/failed.svg"/>
                                &nbsp;
                                Connection failed
                            </h1>
                            <p>
                                The connection code seems to be invalid or the game server could not be contacted.
                                Please try the following options should this issue persist over multiple retries:
                                <ul>
                                    <li>Verify that you entered the code correctly and that your internet connection is stable.</li>
                                    <li class="unblock-hint">
                                        This site uses an encryption certificate.
                                        Your web browser might be blocking the certificate for security reasons.
                                        <br/>
                                        <button id="unblock-cerificate">See instructions for un-blocking the certificate</button>
                                    </li>
                                    <li class="unblock-hint">
                                        Try using the un-encrypted variant of the site:
                                        <a class="insecure-url" href></a>
                                    </li>
                                    <li>
                                        Contact the person who gave you the connection code and/or the person who manages the game server.
                                        The reason could be that the game server is experiencing some down times.
                                        Furhtermore, the game server needs to be accessible to the wider internet.
                                        A connection failure may indicate that the server is inacessible due to firewall restrictions.
                                    </li>
                                </ul>
                            </p>
                            <button id="login-failed-dismiss">Dismiss message</button>
                        </span>
                    </div>
                    <div class="fancy-title">
                        <h3>WELCOME TO</h3>
                        <h1>SKHEIJO</h1>
                    </div>
                    <p>
                        SKHEIJO is a digital adaptation of the German board game <a href="https://www.magilano.com/produkt/skyjo" target="_blank">SKYJO</a> made by Magilano.
                        Our mascot is a hamster called HEIKKI, hence the name adaptation SK<b>HEI</b>JO.
                        <br/>
                        &nbsp;
                        <br/>
                        You need a connection code to join a game.
                        Enter the code into the box below.
                        The connection code uniquely identifies a game server and is usually represented as a sequence of seemingly random characters such as 'MTI3LjAu...'.
                    </p>
                    <input type="text" id="login-string" placeholder="Enter the connection code here."/>
                    <p>
                        <table width="100%">
                            <tr width="100%">
                                <td>
                                    <span id="login-hint" class="hidden">
                                        The code does not seem to be of the correct format.
                                    </span>
                                </td>
                                <td style="text-align: right">
                                    <button id="login-start" class="hidden">Connect ...</button>
                                </td>
                            </tr>
                        </table>
                    </p>
                </div>
            </div>
            <div id="username-container" class="hidden">
                <div id="username-form">
                    <h1>Welcome<span class="veteran"> back</span>!</h1>
                    <p>
                        In order to join a game, please select a name or alias.
                        <span class="veteran">
                            <br/>
                            This is the name you chose last time:
                        </span>
                    </p>
                    <p class="first-only">
                        It looks like you are currently connecting to the game for the first time.
                        We have therefore auto-generated a name for you.
                        You may change it below.
                        <br/>
                        You may also change the name at anytime in the settings menu.
                        <br/>
                        <br/>
                    </p>
                    <input type="text" id="username-input" placeholder="your name or alias" maxlength="32"/>
                    <p>
                        <div style="float:right">
                            <button id="username-generate">Generate a new name</button>
                            <button id="username-apply">Use the user name</button>
                        </div>
                    </p>
                    <span id="username-error"></span>
                </div>
            </div>
            <div id="game-container" class="hidden">
                <div class="menu-bar">
                    <div class="menu-item" data-tab="game"></div>
                    <div class="menu-item" data-tab="leaderboard"></div>
                    <div class="menu-item" data-tab="players"></div>
                    <div class="menu-item" data-tab="share"></div>
                    <div class="menu-item" data-tab="chat"></div>
                    <div class="menu-item" data-tab="notifications"></div>
                    <div class="menu-spacer"></div>
                    <div class="menu-item" data-tab="settings"></div>
                    <div class="menu-item" data-tab="help"></div>
                    <div class="menu-item" data-tab="logout"></div>
                </div>
                <div class="menu-content-holder">
                    <div id="main-game" class="menu-content hidden" data-tab="game">
                        <div class="game-state">
                            <table>
                                <tr>
                                    <td>
                                        Current game state:
                                    </td>
                                    <td id="game-state-text"></td>
                                </tr>
                                <tr>
                                    <td>
                                        Connected players:
                                    </td>
                                    <td id="game-player-count"></td>
                                </tr>
                            </table>
                            <button id="game-join" class="hidden">Join Game</button>
                            <button id="game-leave" class="hidden">Leave Game</button>
                            <button id="admin-start-game" class="admin-only hidden">Start Game</button>
                            <button id="admin-stop-game" class="admin-only hidden">Stop Game</button>
                            <button id="admin-reset-game" class="admin-only hidden">Clear/Reset Game</button>
                        </div>
                        <div class="playing-field-holder">
                            <div id="players" class="playing-field">
                            </div>
                        </div>
                        <div class="ego-side">
                            <div id="ego-player"></div>
                            <div class="right-side">
                                <div class="piles">
                                    <div id="draw-pile" class="pile" data-annotation="draw pile" data-pile="draw"></div>
                                    <div id="discard-pile" class="pile" data-annotation="discard pile" data-pile="discard"></div>
                                    <div id="animation-pile" class="pile" data-pile="animation"></div>
                                </div>
                                <div id="instructions"></div>
                            </div>
                        </div>
                        <span id="final-round-warning"></span>
                    </div>
                    <div class="menu-content hidden" data-tab="players">
                        <h1>Player overview <span class="admin-only">and user management</span></h1>
                        <p>
                            The following list enumerates all players connected to the current server.
                            Note that not all players who are connected to the servers are part of the current game.
                            This occures e.g. when a player connects to the server <i>after</i> a game has been started.
                            Switch to the <a href="#leaderboard">leaderboard tab (<img src="img/menu-leaderboard.svg" style="height: .8em;"/>)</a> for an overview of all players in the current game.
                            <br/>
                            The following list highlights administrators with a badge (<img src="img/admin.svg" style="height: .8em;"/>).
                        </p>
                        <br/>
                        <p>
                            <span id="player-count">0</span> player(s) are currently connected:
                        </p>
                        <div id="player-list"></div>
                        <p class="admin-only">
                            <br/>
                            Players can be elevated to administrator by editing the document <code>server-config.json</code> and
                            adding the respective UUIDs to the <code>/admin_uuids</code>-element.
                            The server must not be running for the changes to take effect - they are overwritten otherwise.
                        </p>
                    </div>
                    <div class="menu-content hidden" data-tab="leaderboard">
                        <h1>Game League Table</h1>
                        <p>
                            The following list enumerates all players participating in the current game ordered by their current points.
                            Please note that the best SKHEIJO players aim for the lowest point score.
                        </p>
                        <div id="leaderboard-list"></div>
                        <br/>
                        <h1>All-time Server Highscores</h1>
                        <p>
                            The following list enumerates all highscores achieved by players on this server.
                            Please note that the best SKHEIJO players aim for the lowest point score.
                        </p>
                        <div id="highscore-list"></div>
                        <p class="admin-only">
                            To delete the server highscores, please navigate to the document <code>server-config.json</code> and remove
                            the element <code>/high_scores</code>.
                            The server must not be running for the changes to take effect - they are overwritten otherwise.
                        </p>
                    </div>
                    <div class="menu-content hidden" data-tab="notifications">
                        <h1>Notification Overview</h1>
                        <p>
                            The following list contains all notifications received from the server and other players in chronological order.
                            The most recent notification can be found at the top, while older notifications can be found further down the list.
                            Critical notifications or error warnings are prefixed with a circled exclamation mark (<img src="img/notifications-failure.svg" style="height: .8em;"/>).
                        </p>
                        <div class="notification-list-wrapper">
                            <div id="notification-list"></div>
                        </div>
                    </div>
                    <div class="menu-content hidden" data-tab="logout">
                        <h3>Are you sure that you want to logout?</h3>
                        <p>
                            <button id="logout-button">Yes. Log me out.</button>
                        </p>
                        <br/>
                        <p>
                            Press the following button if you want to be logged out <b><i>and</i></b> your identity removed.
                        </p>
                        <p>
                            <b>WARNING:</b>
                            The removal of your identity will reset your name and your administrator rights (should you possess any).
                        </p>
                        <p>
                            <button id="reset-logout-button">I know what I'm doing. Reset my identity and log me out.</button>
                        </p>
                    </div>
                    <div class="menu-content hidden" data-tab="share">
                        <h1>Share this game</h1>
                        <p>
                            In order to share a this game with somebody, use the share buttons or copy the following link:
                        </p>
                        <p style="font-size: 1.2em;">
                            <a id="share-url" href></a>
                        </p>
                        <div id="share-container">
                            <button class="share" data-service="whatsapp">WhatsApp</button>
                            <button class="share" data-service="twitter">Twitter</button>
                            <button class="share" data-service="facebook">Facebook</button>
                            <button class="share" data-service="threema">Threema</button>
                            <button class="share" data-service="reddit">Reddit</button>
                            <button class="share" data-service="linkedin">LinkedIn</button>
                            <button class="share" data-service="tumblr">Tumblr</button>
                            <button class="share" data-service="pinterest">Pinterest</button>
                            <button class="share" data-service="telegram">Telegram</button>
                            <button class="share" data-service="vk">ВКонта́кте</button>
                            <button class="share" data-service="skype">Skype</button>
                            <button class="share" data-service="sms">SMS</button>
                            <button class="share" data-service="email">E-Mail</button>
                            <button class="share" data-service="native">Share ...</button>
                        </div>
                        <div class="qr-wrapper"></div>
                    </div>
                    <div class="menu-content hidden" data-tab="help">
                        <h1>Help / About</h1>
                        <p>
                            [TODO]
                        </p>
                        <h2>Game Rules and Usage</h2>
                        <p>
                            SKHEIJO is a fairly straight-forward and simple game.
                            It consists of (at least) 150 cards, each with a numeric value reaching from -2 to +12.
                            The primary goal is to score as few points as possible.
                        </p>
                        <p>
                            A game of SKHEIJO is played as follows:
                        </p>
                        <p>
                            <ol>
                                <li>
                                    Two to ten players join a game.
                                    This can be done by clicking on the <kbd>Join Game</kbd>-button in the game tab.
                                    Please note that a game can only be joined if it has not yet been started.
                                </li>
                                <li>
                                    An administrator starts the game if two or more people have joined the game.
                                    <br/>
                                    <b>
                                        Note to Administrators:
                                    </b>
                                    This can either be done using the server command line
                                    by typing the command "<code>deal</code>" (short for "deal cards"), or by pressing
                                    the <kbd>Start Game</kbd>-button.
                                </li>
                                <li>
                                    After the game has been started, every player uncovers two cards.
                                    This can be done by tapping on any card with a blue outline:
                                    <br/>
                                    <img src="img/help/help-01.png" height="200"/>
                                    <img src="img/help/help-02.png" height="200"/>
                                </li>
                                <li>
                                    Each round is played as follows:
                                    <ol>
                                        <li>
                                            A blue border around the player's game field indicates that it is their turn to play.
                                        </li>
                                        <li>
                                            The current player can now draw a card from either the draw pile or the discard pile.
                                            This is done by dragging the card from the respective pile to the pile labelled "currently drawn".
                                            <br/>
                                            <img src="img/help/help-03.png" height="150"/>
                                            <img src="img/help/help-04.png" height="150"/>
                                        </li>
                                        <li>
                                            The player now has two possibilities:
                                            <ol>
                                                <li>
                                                    The player swaps the currently drawn card with one of their own.
                                                    This is performed by dragging the card onto the desired pile.
                                                    The destination pile can contain an uncovered or non-uncoverd card.
                                                    Valid dragging destinations are highlighted in green.
                                                    <br/>
                                                    <img src="img/help/help-05.png" height="200"/>
                                                    <img src="img/help/help-06.png" height="200"/>
                                                    <br/>
                                                    The player now discards the swapped card by dragging it onto the discard pile.
                                                    <br/>
                                                    <img src="img/help/help-07.png" height="150"/>
                                                </li>
                                                <li>
                                                    The player discards the currently drawn card.
                                                    This is performed by dragging the card onto the discard pile.
                                                    The player is then required to uncover one of their own cards.
                                                    This can be done by tapping any of the cards highlighted in blue.
                                                    <br/>
                                                    <!-- <img src="img/help/help-07.png" height="150"/> -->
                                                    <img src="img/help/help-08.png" height="200"/>
                                                    <img src="img/help/help-09.png" height="200"/>
                                                </li>
                                            </ol>
                                        </li>
                                        <li>
                                            If any action performed by the player (swapping cards, uncovering cards, etc.) results in a column of identical cards, the column will be removed immediately.
                                            <br/>
                                            <img src="img/help/help-10.png" height="200"/>
                                            <img src="img/help/help-11.png" height="200"/>
                                        </li>
                                    </ol>
                                </li>
                                <li>
                                    If a player's game field only consists of uncovered cards, the final round is initiated.
                                    All players are notified of the final round via a notification.
                                    <br/>
                                    <img src="img/help/help-14.png"/>
                                </li>
                                <li>
                                    After the final round has been played, all covered cards will be uncovered.
                                    Every player's point score is determined by the sum of all card values.
                                    The player with the lowest point score wins the game.
                                    <br/>
                                    <br/>
                                    <b>
                                        Please note that a player's final score will be doubled if he or she finishes last.
                                        It is therefore generally not advisable to initiate the final round.
                                    </b>
                                    <br/>
                                    <img src="img/help/help-12.png" height="200"/>
                                    <img src="img/help/help-13.png" height="200"/>
                                </li>
                            </ol>
                        </p>
                        TODO: usage instructions
                    </div>
                    <div class="menu-content hidden" data-tab="settings">
                        <h1>User Settings</h1>
                        <p>
                            The following text field contains your player UUID.
                            UUID stands for 'Universally Unique Identifier' and uniquely identifies you on the game server.
                            Do not share your UUID with other players &#8212; only with the server administrator when required to do so.
                            You can reset your UUID in the <a href="#logout">logout menu (<img src="img/menu-logout.svg" style="height: .8em;"/>)</a>.
                        </p>
                        <code id="user-uuid">{00000000-0000-0000-0000-000000000000}</code>
                        <p>
                            You can change your user name / alias in the text box below.
                            Confirm your change by typing <kbd>ENTER</kbd>.
                        </p>
                        <p>
                            <input id="user-name" type="text" placeholder="Username with a length of 2..32 characters" maxlength="32"/>
                        </p>
                        <span id="user-error"></span>
                        <br/>
                        <h1>Other Settings</h1>
                        <p>
                            TODO: auto login<br/>
                        </p>
                        <div class="admin-only">
                            <h1>Game Settings</h1>
                            <p>
                                You can change the number of initial rows and columns of cards for each player using the following two input fields:
                            </p>
                            <p>
                                <input id="init-board-rows" type="number" min="2" max="5" value="3" placeholder="3"/> Rows
                                &nbsp;x&nbsp;
                                <input id="init-board-cols" type="number" min="2" max="10" value="4" placeholder="4"/> Columns
                            </p>
                            <p>
                                <button id="change-init-board-size">Change the number of initial rows and columns</button>
                                <br/>
                                <b>Warning:</b>
                                Changing the size may cause the current game to be stopped and/or reset.
                            </p>
                            <p>
                                The initial board size may also be changed by navigating to the document <code>server-config.json</code>
                                and changing the values of <code>/init_board_size/rows</code> and <code>/init_board_size/rows</code> manually.
                                <br/>
                                The server must not be running for the changes to take effect -- they are overwritten otherwise.
                            </p>
                            <hr/>
                            <h1>Shut down the Server</h1>
                            <button id="shut-down-server">
                                I KNOW WHAT I'M DOING.
                                <br/>
                                I KNOW THAT I'LL HAVE TO RESTART THE SERVER MANUALLY.
                                I HAVE PHYSICALL ACCESS TO THE MACHINE ON WHICH THE SERVER IS RUNNING.
                                I KNOW HOW TO RESTART THE SERVER AND/OR HOW TO USE THE COMMAND LINE.
                            </button>
                        </div>
                    </div>
                    <div class="menu-content hidden" data-tab="chat">
                        <div class="chat-container">
                            <div class="chat-header">
                                <h1>Server-wide chat room</h1>
                                <span class="admin-only">
                                    <b>Note to Administrators:</b>
                                    You can edit and/or clear the chat by modifying the document
                                    <code>chat-messages.json</code> <b>after</b> shutting down the server.
                                </span>
                            </div>
                            <div id="chat-message-list" class="chat-messages"></div>
                            <div class="chat-footer">
                                <div id="chat-mention-menu" class="hidden"></div>
                                <div id="chat-input">
                                    <div class="input" contenteditable="true" spellcheck="true"></div>
                                    <div class="placeholder">Type your message here</div>
                                </div>
                                <div id="chat-mention"></div>
                                <div id="chat-send" class="hidden"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="background-container">
                <div class="fancy-title">
                    <h1>SKHEIJO</h1>
                    <h3>A HEIKKI GAME</h3>
                </div>
            </div>
        </div>
        <script>
            var on_page_loaded = undefined;
        </script>
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/jquery-ui.min.js"></script>
        <script type="text/javascript" src="js/jquery-ui-touch.min.js"></script>
        <script type="text/javascript" src="js/confetti.js"></script>
        <script type="text/javascript" src="js/qrcode.js"></script>
        <script type="text/javascript" src="js/uuid.js"></script>
        <script type="text/javascript" src="js/browser.js"></script>
        <script type="text/javascript" src="js/script.js"></script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-X58DTKP1DB"></script>
        <script>
            window.dataLayer = window.dataLayer || [];

            function gtag() { dataLayer.push(arguments); }

            gtag('js', new Date());
            gtag('config', 'G-X58DTKP1DB');
        </script>
    </body>
</html>
